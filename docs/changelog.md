/**
 * @file: changelog.md
 * @description: Хронологический журнал изменений проекта обработки текста с ИИ.
 * @dependencies: None
 * @created: 2024-07-29
 */

# Журнал изменений

## [2024-07-30] - Обновление конфигурации API ключа и переход на OpenRouter

### Изменено
- Скрипт `tools/check_text_languagetool.py` модифицирован для использования OpenRouter API (`https://openrouter.ai/api/v1`) вместо прямого OpenAI API.
- В качестве модели ИИ указана `qwen/qwen3-235b-a22b:free` (ID уточнен).
- Предоставленный API-ключ OpenRouter добавлен в код `tools/check_text_languagetool.py` как значение по умолчанию, если переменная окружения `OPENROUTER_API_KEY` не установлена. Добавлено информационное сообщение об этом.
- Обновлены конфигурационные переменные (OPENROUTER_API_KEY, YOUR_SITE_URL, YOUR_APP_NAME) и логика их использования. Для `YOUR_SITE_URL` значение по умолчанию изменено на `http://localhost` для локальной разработки.
- Внесены исправления в f-строки и обработку API ключа в `tools/check_text_languagetool.py`.
- Обновлена документация (`Project.md`, `Tasktracker.md`, `Diary.md`, `qa.md`, `changelog.md`) для отражения использования OpenRouter, уточненного ID модели Qwen и информации об API-ключе и заголовках.

### Добавлено
- В скрипт добавлены необходимые заголовки (`HTTP-Referer`, `X-Title`) для запросов к OpenRouter.

### Исправлено
- Улучшена обработка отсутствующего или некорректного API ключа.

---

## [2024-07-29] - Начало работы над интеграцией ИИ для исправления ошибок

### Добавлено
- Создана базовая структура документации в директории `docs/`:
  - `Project.md`: Обновлено описание проекта, добавлен раздел об ИИ-коррекции.
  - `Tasktracker.md`: Добавлена задача по интеграции ИИ для исправления ошибок.
  - `Diary.md`: Сделана запись о планах по интеграции ИИ.
  - `qa.md`: Подготовлен файл для вопросов, добавлены первые вопросы по ИИ-интеграции.
  - `changelog.md`: Инициализирован данный журнал изменений.
- Добавлена библиотека `openai` в `requirements.txt`.

### Изменено
- (Пока нет изменений в коде)

### Исправлено
- (Пока нет исправлений)

---

## [2024-07-27] - Инициализация проекта и базовой структуры

### Добавлено
- Создана первоначальная структура проекта.
- Созданы базовые файлы документации: `Project.md`, `Tasktracker.md`, `Diary.md`, `qa.md`.

### Изменено
- Нет.

### Исправлено
- Нет.

## [2024-07-31] - Разделение пайплайна на два этапа
### Добавлено
- Созданы отдельные скрипты: run_stage1.py (DOCX→HTML→Типограф) и run_stage2.py (HTML→LT→автокоррекция→DOCX).
### Изменено
- Архитектура пайплайна теперь позволяет запускать и тестировать этапы независимо.

## [2024-07-31] - Интеграция модулей автокоррекции, типографики и конвертации в DOCX
### Добавлено
- Реализованы модули src/pipeline/autocorrect_processor_module.py, src/pipeline/typograf_processor_module.py, src/pipeline/html_to_docx_processor_module.py.
- orchestrator.py обновлён: теперь пайплайн включает этапы автокоррекции, типографики и конвертации HTML в DOCX.
### Изменено
- Пайплайн теперь полностью автоматизирован: от проверки текста до финального DOCX.
### Исправлено
- Исправлены ошибки передачи параметров и логирования между этапами.

## [2024-07-31] - Актуализация автокоррекции: LLM только подтверждает исправления
### Изменено
- AutocorrectProcessorModule теперь применяет только автоматические исправления, каждое подтверждается LLM (OpenRouter).
- LanguageToolProcessorModule больше не вызывает LLM, только анализирует и формирует отчёт.
### Исправлено
- Исключена дублирующая работа LLM на этапе LanguageTool.

## [2025-05-27] - Тестирование новых файлов и подтверждение стабильности
### Добавлено
- Проведено тестирование пайплайна на пяти новых файлах: «Проза БЭНД Александра Кулагина», «Проза БЭНД Ирина Банах», «Проза БЭНД Марина Хорт», «Проза БЭНД Петр Кравченко», «Проза Марина Мишанина_юность»
- Финальные DOCX-файлы успешно сформированы и сохранены в workspace/output

### Изменено
- Уточнена документация по этапам тестирования

### Исправлено
- Ошибок и сбоев не выявлено, пайплайн работает стабильно

## [2024-07-31] - Требование сохранять итоговый HTML-файл перед экспортом
### Добавлено
- В документацию и трекер задач добавлено требование: итоговый HTML-файл (final.html) должен сохраняться в output перед конвертацией в любой формат (docx, pdf, epub и др.).
### Изменено
- Project.md, Tasktracker.md, Diary.md, qa.md актуализированы с учетом нового требования.

## [2025-05-27] - Автоматическое сохранение итогового HTML (final.html)
### Добавлено
- В run_stage2.py реализовано автоматическое копирование финального HTML-файла в workspace/output/final.html перед экспортом в DOCX.
- Проведён тест на файле «Лицом к лицу Денис Лукьянов Даша Благова_интервью_юность (1).docx»: файл final.html успешно создан и содержит итоговый HTML.
### Изменено
- Обновлён пайплайн: теперь итоговый HTML всегда доступен для аудита перед экспортом.
### Исправлено
- Нет.

## [2024-07-31] - Добавлено сохранение итогового HTML файла

### Добавлено
- Автоматическое сохранение итогового HTML файла в директорию output как final.html
- Создание директории output при инициализации пайплайна
- Логирование результатов сохранения HTML файла
- Добавление пути к итоговому HTML файлу в статус пайплайна

### Изменено
- Расширен формат статуса пайплайна для включения пути к итоговому HTML файлу

### Исправлено
- Отсутствие сохранения промежуточных результатов для последующих конвертаций

## [2024-07-31] - Оптимизация сохранения HTML файлов
### Изменено
- Удалено создание дополнительного final.html
- Для конвертации используется последний HTML файл из пайплайна (output_from_stage4_html)
- Упрощен формат статуса пайплайна

## [2024-07-31] - Итоговый HTML сохраняется с именем исходного файла
### Изменено
- Итоговый HTML-файл теперь сохраняется в workspace/output/ под именем исходного файла (docx → html)
- Статус пайплайна отражает путь к этому файлу

## [2024-07-31] - Интеграция пайплайна с webapp
### Добавлено
- Воркер Flask-приложения теперь запускает orchestrator.py для обработки загруженных файлов.
- Итоговый DOCX-файл автоматически копируется в webapp/results/ и доступен для скачивания через веб-интерфейс.
### Изменено
- Удалён вызов build-book.sh, пайплайн полностью на Python.

## [2025-06-02] - Универсализация обработки файлов и поддержки форматов
### Добавлено
- Поддержка загрузки и обработки файлов форматов: docx, pdf, epub, html (и других, при необходимости).
- Универсальная логика формирования имени результата: [basename]_final.[ext] для всех поддерживаемых форматов.
- Сохранение и отображение оригинального имени файла на всех этапах (очередь, результат, интерфейс).

### Изменено
- Рефакторинг функций скачивания и удаления файлов для поддержки всех форматов.

### Исправлено
- Исключены ошибки, связанные с некорректным отображением имени результата и оригинального имени файла.

## [2025-06-02] - Корректное формирование имён итоговых файлов по всему пайплайну
### Добавлено
- Итоговые файлы в workspace/output теперь всегда формируются с использованием оригинального имени пользователя: [basename]_final.[ext] (docx, html и др.).
- Передача basename реализована на всех этапах пайплайна.

### Изменено
- Рефакторинг orchestrator.py, docx_to_html_converter.py, html_to_docx_processor_module.py для поддержки универсального именования.

### Исправлено
- Исключены случаи, когда результат имел фиксированное имя (docx_final.docx и т.д.), не связанное с исходным файлом.

## [2025-06-02] - Итоговые файлы теперь строго по оригинальному имени пользователя
### Изменено
- orchestrator.py теперь использует переданный basename для формирования итоговых файлов в workspace/output.
- Итоговые файлы всегда называются [оригинальное_имя]_final.[ext], даже если имя содержит пробелы, запятые и кириллицу.

### Исправлено
- Исключены случаи, когда имя результата терялось или заменялось на безопасное.